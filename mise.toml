[settings]
python.uv_venv_auto = true

[tools]
python = "3.13.7"
uv = "0.9.11"
ruff = "0.14.6"

# Dependencies
[tasks.sync]
description = "Install all dependencies"
run = [
  "uv sync --all-packages --extra dev",
]

[tasks.update]
description = "Update all dependencies"
alias = "u"
run = "uv sync --all-packages --extra dev -U"

[tasks.outdated]
description = "List outdated dependencies"
run = "uv pip list --outdated"

# Code quality
[tasks.format]
description = "Format and fix linting issues"
run = ["ruff format", "ruff check --fix"]

[tasks.lint]
description = "Run type checking on all packages"
run = ["uv run mypy ."]

[tasks.check]
description = "Quick pre-push checks: format, lint, test-unit"
depends = ["format", "lint", "test-unit"]

# Testing
[tasks.test]
description = "Run all tests including live network tests"
run = "uv run pytest packages/core/tests --run-live"

[tasks.test-unit]
description = "Run unit tests only"
run = "uv run pytest packages/core/tests/unit"

# Development: CLI
[tasks.dev-cli]
description = "Run CLI during development (e.g., mise run dev-cli -- extract <url>)"
run = "uv run drainloader"

# Build
[tasks.build-bin]
description = "Build CLI binary locally for testing (Windows only)"
run = [
  "uv pip install pyinstaller",
  "uv run pyinstaller --onefile --name drainloader-cli-windows --paths packages/core packages/cli/drainloader_cli/main.py",
]
